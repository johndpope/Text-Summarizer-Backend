module.exports=function(e){var t={};function a(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a.w={},a(a.s=38)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1),s=c(r),i=c(a(26)),o=a(25),n=c(a(24)),u=c(a(11)),l=c(a(2)),d=c(a(10));function c(e){return e&&e.__esModule?e:{default:e}}const f=new r.Schema({email:{type:String,unique:!0,required:!0,trim:!0,validate:{validator:e=>i.default.isEmail(e),message:"{VALUE} is not a valid email!"}},firstName:{type:String,required:[!0,"First name is required"],trim:!0},lastName:{type:String,required:[!0,"Last name is required"],trim:!0},userName:{type:String,required:[!0,"User name is required"],trim:!0,unique:!0},photo:{data:Buffer,contentType:String},password:{type:String,required:[!0,"Password is required"],trim:!0,minlength:[6,"Password need to be longer"]},favourites:{articles:[{type:r.Schema.Types.ObjectId,ref:"Article"}]},toRead:{articles:[{type:r.Schema.Types.ObjectId,ref:"Article"}]},followings:[{type:r.Schema.Types.ObjectId,ref:"User"}],followers:[{type:r.Schema.Types.ObjectId,ref:"User"}]},{timestamps:!0});f.plugin(u.default,{message:"{VALUE} already taken!"}),f.pre("save",function(e){return this.isModified("password")&&(this.password=this._hashPassword(this.password)),e()}),f.methods={_hashPassword:e=>(0,o.hashSync)(e),authenticateUser(e){return(0,o.compareSync)(e,this.password)},createToken(){return n.default.sign({_id:this._id},l.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,userName:this.userName,token:`JWT ${this.createToken()}`}},toJSON(){return{_id:this._id,userName:this.userName,firstName:this.firstName,lastName:this.lastName,photo:this.photo}},savePhoto(e,t){this.photo.data=e,this.photo.contentType=t,this.save()},_favourites:{async articles(e){return this.favourites.articles.indexOf(e)>=0?(this.favourites.articles.remove(e),await d.default.decFavourite(e)):(this.favourites.articles.push(e),await d.default.incFavourite(e)),this.save()},isArticleIsFavourite(e){return this.favourites.articles.indexOf(e)>=0}},_toRead:{async articles(e){return this.toRead.articles.indexOf(e)>=0?(this.toRead.articles.remove(e),await d.default.removeToRead(e)):(this.toRead.articles.push(e),await d.default.addToRead(e)),this.save()}},_followings:{async add(e){this.followings.indexOf(e)>=0?(console.log("removing user from following list"),this.followings.remove(e)):(console.log("adding new user to following list"),this.followings.push(e)),this.save()}},_followers:{async add(e){this.followers.indexOf(e)>=0?(console.log("removing user from followers list"),this.followers.remove(e)):(console.log("adding new user to followers list"),this.followers.push(e)),this.save()}}},f.statics={async checkFollower(e,t){(await this.findById(e))._followers.add(t)}},t.default=s.default.model("User",f)},function(e,t){e.exports=require("mongoose")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={MONGO_URL:"mongodb://localhost:27017/supreme-posts-dev",JWT_SECRET:"thisIsASecret"},s={MONGO_URL:"mongodb://localhost:27017/supreme-posts-test"},i={MONGO_URL:"mongodb://admin:admin@ds251518.mlab.com:51518/likerss"},o={PORT:process.env.PORT||3e3,JWT_SECRET:"thisIsASecret"};t.default=Object.assign({},o,function(e){switch(e){case"development":return r;case"test":return s;default:return i}}("production"))},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http-status")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mult=void 0;var r,s=a(22),i=(r=s)&&r.__esModule?r:{default:r};const o={storage:i.default.diskStorage({destination:(e,t,a)=>{a(null,"src/modules/uploads/profile-photos")},filename:(e,t,a)=>{console.log(t);const r=t.mimetype.split("/")[1];a(null,t.fieldname+"-"+Date.now()+"."+r)}}),fileFilter:(e,t,a)=>{if(t||a(),!t.mimetype.startsWith("image/"))return console.log("file not supported"),a();console.log("photo uploaded"),a(null,!0)}};t.mult=(0,i.default)(o).single("photo")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authJwt=t.authLocal=void 0;var r=u(a(12)),s=u(a(28)),i=a(27),o=u(a(0)),n=u(a(2));function u(e){return e&&e.__esModule?e:{default:e}}const l=new s.default({usernameField:"email"},async(e,t,a)=>{try{const r=await o.default.findOne({email:e});return r&&r.authenticateUser(t)?a(null,r):a(null,!1)}catch(e){return a(e,!1)}}),d={jwtFromRequest:i.ExtractJwt.fromAuthHeaderWithScheme("jwt"),secretOrKey:n.default.JWT_SECRET},c=new i.Strategy(d,async(e,t)=>{try{const a=await o.default.findById(e._id);return t(null,a?a:!1)}catch(e){return t(e,!1)}});r.default.use(l),r.default.use(c);t.authLocal=r.default.authenticate("local",{session:!1}),t.authJwt=r.default.authenticate("jwt",{session:!1})},function(e,t){e.exports=require("joi")},function(e,t){e.exports=require("express-validation")},function(e,t){e.exports=require("slug")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1),s=u(r),i=u(a(9)),o=u(a(11)),n=u(a(23));function u(e){return e&&e.__esModule?e:{default:e}}const l=new r.Schema({title:{type:String,trim:!0,required:[!0,"Title is required"],minlength:[3,"Title need to be longer"],maxlength:[24,"Title need to be shorter"],unique:!0},text:{type:String,trim:!0,required:[!0,"Text is required"],minlength:[10,"Text need to be longer"]},summary:{type:String,trim:!0,minLength:[10,"Summary need to be longer"]},photo:{data:Buffer,contentType:String},slug:{type:String,trim:!0,lowercase:!0},user:{type:r.Schema.Types.ObjectId,ref:"User"},favouriteCount:{type:Number,default:0},toReadFlag:{type:Boolean,default:!1}},{timestamps:!0});l.plugin(o.default,{message:"{VALUE} already taken!"}),l.pre("validate",function(e){this._slugify(),e()}),l.methods={_slugify(){this.slug=(0,i.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,summary:this.summary,createdAt:this.createdAt,user:this.user,favoriteCount:this.favoriteCount}},savePhoto(e,t){this.photo.data=e,this.photo.contentType=t,this.save()}},l.statics={createArticle(e,t){return this.create(Object.assign({},e,{user:t}))},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate("user")},summarizeText(e,t,a){console.log("inside summarizeText");const r={pythonPath:"/usr/bin/python3",pythonOptions:["-u"],args:[t,a]},s=new n.default("/Summarization/Engine/predicter.py",r);s.on("message",t=>{console.log(t),e.summary=t,e.save()}),s.end((e,t,a)=>{if(e)throw e;console.log("The exit code was: ",t),console.log("The exit signal was: ",a),console.log("python-shell has finished excuting")})},incFavourite(e){return this.findByIdAndUpdate(e,{$inc:{favouriteCount:1}})},decFavourite(e){return this.findByIdAndUpdate(e,{$inc:{favouriteCount:-1}})},addToRead(e){return this.findByIdAndUpdate(e,{toReadFlag:!0})},removeToRead(e){return this.findByIdAndUpdate(e,{toReadFlag:!1})}},t.default=s.default.model("Article",l)},function(e,t){e.exports=require("mongoose-unique-validator")},function(e,t){e.exports=require("passport")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1),s=i(r);i(a(9));function i(e){return e&&e.__esModule?e:{default:e}}const o=new r.Schema({title:{type:String,trim:!0,required:[!0,"Collection title is requires"],minlength:[3,"Title need to be longer"],maxlength:[24,"Title need to be shorter"],unique:!0},description:{type:String,trim:!0,required:!1,minlength:[5,"Description need to be longer"],maxlength:[48,"Description need to be shorter"]},photo:{data:Buffer,contentType:String},user:{type:r.Schema.Types.ObjectId,ref:"User"},articles:[{type:r.Schema.Types.ObjectId,ref:"Article"}]},{timestamps:!0});o.methods={toJSON(){return{_id:this._id,title:this.title,description:this.description,photo:this.photo,user:this.user,articles:this.articles,createdAt:this.createdAt}},savePhoto(e,t){this.photo.data=e,this.photo.contentType=t,console.log("saving photo to db"),this.save()},_articles:{add(e){this.articles.indexOf(e)>=0?(console.log("removing article from collection"),this.articles.remove(e)):(console.log("adding article to collection"),this.article.push(e)),this.save()}}},o.statics={createCollection(e,t){return this.create(Object.assign({},e,{user:t}))}},t.default=s.default.model("Collection",o)},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCollection=async function(e,t){try{const a=await s.default.createCollection(e.body,e.user._id);return e.file&&a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.CREATED).json(a)}catch(e){t.status(r.default.BAD_REQUEST).json(e)}},t.updateCollection=async function(e,t){try{const a=await s.default.findById(e.params.id);return a.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{a[t]=e.body[t]}),e.file&&a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.OK).json(await a.save())):t.sendStatus(r.default.UNAUTHORIZED)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.getCollectionById=async function(e,t){try{const a=await s.default.findById(e.params.id).populate("articles").populate("user");return t.status(r.default.OK).json(a)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.addArticleToCollection=async function(e,t){try{const a=await s.default.findById(e.params.cid);return await a._articles.add(e.params.aid),t.sendStatus(r.default.OK)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.deleteCollection=async function(e,t){try{const a=await s.default.findById(e.params.id);return a.user.equals(e.user._id)?(await a.remove(),t.sendStatus(r.default.OK)):t.sendStatus(r.default.UNAUTHORIZED)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.getUserCollections=async function(e,t){try{const a=await s.default.find({user:e.params.uid}).populate("articles");return t.status(r.default.OK).json(a)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}};var r=i(a(4)),s=i(a(13));i(a(0));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=a(7),i=(r=s)&&r.__esModule?r:{default:r};t.default={createCollection:{body:{title:i.default.string().min(3).max(24).required(),description:i.default.string().min(10).max(48)}},updateCollection:{body:{title:i.default.string().min(5).max(24),description:i.default.string().min(10).max(48)}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(3),s=l(a(8)),i=l(a(15)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(14)),n=a(6),u=a(5);function l(e){return e&&e.__esModule?e:{default:e}}const d=new r.Router;d.post("/",n.authJwt,u.mult,(0,s.default)(i.default.createCollection),o.createCollection),d.patch("/:id",n.authJwt,u.mult,(0,s.default)(i.default.updateCollection),o.updateCollection),d.get("/:id",n.authJwt,o.getCollectionById),d.post("/:cid/:aid",n.authJwt,o.addArticleToCollection),d.delete("/:id",n.authJwt,o.deleteCollection),d.get("/user/:uid",n.authJwt,o.getUserCollections),t.default=d},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createArticle=async function(e,t){try{const a=await i.default.createArticle(e.body,e.user._id);return await i.default.summarizeText(a,e.body.title,e.body.text),e.file&&await a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.CREATED).json(a)}catch(e){t.status(r.default.BAD_REQUEST).json(e)}},t.getArticleById=async function(e,t){try{const a=await Promise.all([s.default.findById(e.user._id),i.default.findById(e.params.id).populate("user")]),o=a[0]._favourites.isArticleIsFavourite(e.params.id),n=a[1];return t.status(r.default.OK).json(Object.assign({},n.toJSON(),{favourite:o}))}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.getArticlesList=async function(e,t){try{const a=await Promise.all([s.default.findById(e.user._id),i.default.list({limit:parseInt(e.query.limit,0),skip:parseInt(e.query.skip,0)})]),o=a[1].reduce((e,t)=>{const r=a[0]._favourites.isArticleIsFavourite(t._id);return e.push(Object.assign({},t.toJSON(),{favourite:r})),e},[]);return t.status(r.default.OK).json(o)}catch(e){t.status(r.default.BAD_REQUEST).json(e)}},t.updateArticle=async function(e,t){try{const a=await i.default.findById(e.params.id);return a.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{a[t]=e.body[t]}),e.file&&await a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.OK).json(await a.save())):t.sendStatus(r.default.UNAUTHORIZED)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.deleteArticle=async function(e,t){try{const a=await i.default.findById(e.params.id);return a.user.equals(e.user._id)?(await a.remove(),t.sendStatus(r.default.OK)):t.sendStatus(r.default.UNAUTHORIZED)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.favouriteArticle=async function(e,t){try{const a=await s.default.findById(e.user._id);return await a._favourites.articles(e.params.id),t.sendStatus(r.default.OK)}catch(e){t.status(r.default.BAD_REQUEST).json(e)}},t.toReadArticle=async function(e,t){try{const a=await s.default.findById(e.user._id);return await a._toRead.articles(e.params.id),t.sendStatus(r.default.OK)}catch(e){t.status(r.default.BAD_REQUEST).json(e)}};var r=o(a(4)),s=o(a(0)),i=o(a(10));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=a(7),i=(r=s)&&r.__esModule?r:{default:r};t.default={createArticle:{body:{title:i.default.string().min(3).max(24).required(),text:i.default.string().min(10).required()}},updateArticle:{body:{title:i.default.string().min(3).max(24),text:i.default.string().min(10)}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(3),s=l(a(8)),i=l(a(18)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(17)),n=a(6),u=a(5);function l(e){return e&&e.__esModule?e:{default:e}}const d=new r.Router;d.post("/",n.authJwt,u.mult,(0,s.default)(i.default.createArticle),o.createArticle),d.get("/:id",n.authJwt,o.getArticleById),d.get("/",n.authJwt,o.getArticlesList),d.patch("/:id",n.authJwt,u.mult,(0,s.default)(i.default.updateArticle),o.updateArticle),d.delete("/:id",n.authJwt,o.deleteArticle),d.post("/:id/favourite",n.authJwt,o.favouriteArticle),d.post("/:id/toread",n.authJwt,o.toReadArticle),t.default=d},function(e,t){e.exports=require("fs")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.signup=async function(e,t){try{const a=await s.default.create(e.body);return e.file&&a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.CREATED).json(a.toAuthJSON())}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.login=function(e,t,a){return t.status(r.default.OK).json(e.user.toAuthJSON()),a()},t.follow=async function(e,t){try{const a=await s.default.findById(e.user._id);return await a._followings.add(e.params.id),await s.default.checkFollower(e.params.id,e.user.id),t.sendStatus(r.default.OK)}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}},t.update=async function(e,t){try{const a=await s.default.findById(e.user._id);return Object.keys(e.body).forEach(t=>{a[t]=e.body[t]}),e.file&&await a.savePhoto(e.file.path,e.file.mimetype),t.status(r.default.OK).json(await a.save())}catch(e){return t.status(r.default.BAD_REQUEST).json(e)}};var r=i(a(4)),s=(i(a(20)),i(a(0)));function i(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("python-shell")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("validator")},function(e,t){e.exports=require("passport-jwt")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("path")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=a(3),i=a(29),o=((r=i)&&r.__esModule,a(6)),n=a(5),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(21));const l=new s.Router;l.post("/signup",n.mult,u.signup),l.post("/login",o.authLocal,u.login),l.post("/:id/follow",o.authJwt,u.follow),l.patch("/update",o.authJwt,n.mult,u.update),t.default=l},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(a(30)),s=o(a(19)),i=o(a(16));function o(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use("/api/v1/users",r.default),e.use("/api/v1/articles",s.default),e.use("/api/v1/collections",i.default)})},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("morgan")},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(a(35));var r=n(a(34)),s=n(a(33)),i=n(a(32)),o=n(a(12));function n(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use((0,s.default)()),e.use((0,i.default)()),e.use(r.default.json()),e.use(r.default.urlencoded({extended:!0})),e.use(o.default.initialize())})},function(e,t,a){"use strict";var r=i(a(1)),s=i(a(2));function i(e){return e&&e.__esModule?e:{default:e}}r.default.Promise=global.Promise;try{r.default.connect(s.default.MONGO_URL)}catch(e){r.default.createConnection(s.default.MONGO_URL)}r.default.connection.once("open",()=>console.log("MongodDB Running")).on("error",e=>{throw e})},function(e,t,a){"use strict";var r=n(a(3)),s=n(a(2));a(37);var i=n(a(36)),o=n(a(31));function n(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.default)();(0,i.default)(u),u.get("/",(e,t)=>{t.send("Hello World!")}),(0,o.default)(u),u.listen(s.default.PORT,e=>{if(e)throw e;console.log(`\n       Server running on port: ${s.default.PORT}\n       ---\n       Running on: production\n       ---\n       Make something great\n       `)})}]);