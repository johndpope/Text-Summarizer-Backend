module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=55)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(2),a=f(n),i=f(o(36)),s=o(35),r=f(o(34)),u=f(o(19)),l=o(1),d=f(o(3)),c=f(o(9));function f(e){return e&&e.__esModule?e:{default:e}}const p=new n.Schema({email:{type:String,unique:!0,trim:!0,validate:{validator:e=>i.default.isEmail(e),message:"{VALUE} is not a valid email!"}},firstName:{type:String,trim:!0},lastName:{type:String,trim:!0},userName:{type:String,required:[!0,"User name is required"],trim:!0,unique:!0},photo:{type:String,trim:!0},password:{type:String,trim:!0,minlength:[6,"Password need to be longer"]},twitter:{id:String,fullName:String,screenName:String},favourites:{articles:[{type:n.Schema.Types.ObjectId,ref:"Article"}]},toRead:{articles:[{type:n.Schema.Types.ObjectId,ref:"Article"}]},followings:[{type:n.Schema.Types.ObjectId,ref:"User"}],followers:[{type:n.Schema.Types.ObjectId,ref:"User"}]},{timestamps:!0});p.plugin(u.default,{message:"{VALUE} already taken!"}),p.pre("save",function(e){return this.isModified("password")&&(this.password=this._hashPassword(this.password)),e()}),p.methods={_hashPassword:e=>(0,s.hashSync)(e),authenticateUser(e){return(0,s.compareSync)(e,this.password)},createToken(){return r.default.sign({_id:this._id},d.default.JWT_SECRET)},toAuthJSON(){return{_id:this._id,userName:this.userName,photo:this.photo,twitter:this.twitter,token:`JWT ${this.createToken()}`,favourites:this.favourites,toRead:this.toRead,followings:this.followings,followers:this.followers,photo:this.photo}},toJSON(){return{_id:this._id,userName:this.userName,firstName:this.firstName,lastName:this.lastName,favourites:this.favourites,toRead:this.toRead,followings:this.followings,followers:this.followers,photo:this.photo}},savePhoto(e){l.minioClient.putObject("mybucket",e.originalname,e.buffer,"application/octet-stream",function(e,t){if(e)return console.log(e);console.log("File uploaded successfully.")}),this.photo=e.originalname,this.save()},_favourites:{async articles(e){return this.favourites.articles.indexOf(e)>=0?(this.favourites.articles.remove(e),await c.default.decFavourite(e)):(this.favourites.articles.push(e),await c.default.incFavourite(e)),this.save()},isArticleIsFavourite(e){return this.favourites.articles.indexOf(e)>=0}},_toRead:{async articles(e){return this.toRead.articles.indexOf(e)>=0?(this.toRead.articles.remove(e),await c.default.removeToRead(e)):(this.toRead.articles.push(e),await c.default.addToRead(e)),this.save()}},_followings:{async add(e){this.followings.indexOf(e)>=0?(console.log("removing user from following list"),this.followings.remove(e)):(console.log("adding new user to following list"),this.followings.push(e)),this.save()}},_followers:{async add(e){this.followers.indexOf(e)>=0?(console.log("removing user from followers list"),this.followers.remove(e)):(console.log("adding new user to followers list"),this.followers.push(e)),this.save()}}},p.statics={async checkFollower(e,t){(await this.findById(e))._followers.add(t)}},t.default=a.default.model("User",p)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.minioClient=void 0;var n=o(20);t.minioClient=new n.Client({endPoint:"play.minio.io",port:9e3,secure:!0,accessKey:"Q3AM3UQ867SPQQA43P2F",secretKey:"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG"})},function(e,t){e.exports=require("mongoose")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={MONGO_URL:"mongodb://admin:admin@ds251518.mlab.com:51518/likerss"},a={PORT:process.env.PORT||3e3,JWT_SECRET:"thisIsASecret"};t.default=Object.assign({},a,n)},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("express")},function(e,t,o){"use strict";var n=u(o(5)),a=u(o(3));o(48);var i=u(o(47)),s=u(o(42)),r=u(o(21));function u(e){return e&&e.__esModule?e:{default:e}}const l=(0,n.default)();l.use((0,r.default)({secret:"this is my secret session"})),(0,i.default)(l),l.get("/",(e,t)=>{t.status(200).send("Hello World!")}),(0,s.default)(l),l.listen(a.default.PORT,e=>{if(e)throw e;console.log(`\n       Server running on port: ${a.default.PORT}\n       ---\n       Running on: production\n       ---\n       Make something great\n       `)}),e.exports=l},function(e,t){e.exports=require("supertest")},function(e,t){e.exports=require("http-status")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(2),a=l(n),i=l(o(18)),s=l(o(19)),r=l(o(33)),u=o(1);function l(e){return e&&e.__esModule?e:{default:e}}const d=new n.Schema({title:{type:String,trim:!0,required:[!0,"Title is required"],minlength:[3,"Title need to be longer"],maxlength:[24,"Title need to be shorter"],unique:!0},text:{type:String,trim:!0,required:[!0,"Text is required"],minlength:[10,"Text need to be longer"]},summary:{type:String,trim:!0,minLength:[10,"Summary need to be longer"]},photo:{type:String,trim:!0},slug:{type:String,trim:!0,lowercase:!0},user:{type:n.Schema.Types.ObjectId,ref:"User"},favouriteCount:{type:Number,default:0},toReadFlag:{type:Boolean,default:!1}},{timestamps:!0});d.plugin(s.default,{message:"{VALUE} already taken!"}),d.pre("validate",function(e){this._slugify(),e()}),d.methods={_slugify(){this.slug=(0,i.default)(this.title)},toJSON(){return{_id:this._id,title:this.title,text:this.text,summary:this.summary,createdAt:this.createdAt,user:this.user,favoriteCount:this.favoriteCount,photo:this.photo}},savePhoto(e){u.minioClient.putObject("mybucket",e.originalname,e.buffer,"application/octet-stream",function(e,t){if(e)return console.log(e);console.log("File uploaded successfully.")}),this.photo=e.originalname,this.save()}},d.statics={createArticle(e,t){return this.create(Object.assign({},e,{user:t}))},list({skip:e=0,limit:t=5}={}){return this.find().sort({createdAt:-1}).skip(e).limit(t).populate("user")},summarizeText(e,t,o){console.log("inside summarizeText");const n={pythonPath:"/usr/bin/python3",pythonOptions:["-u"],args:[t,o]},a=new r.default("/Summarization/Engine/predicter.py",n);a.on("message",t=>{console.log(t),e.summary=t,e.save()}),a.end((e,t,o)=>{if(e)throw e;console.log("The exit code was: ",t),console.log("The exit signal was: ",o),console.log("python-shell has finished excuting")})},incFavourite(e){return this.findByIdAndUpdate(e,{$inc:{favouriteCount:1}})},decFavourite(e){return this.findByIdAndUpdate(e,{$inc:{favouriteCount:-1}})},addToRead(e){return this.findByIdAndUpdate(e,{toReadFlag:!0})},removeToRead(e){return this.findByIdAndUpdate(e,{toReadFlag:!1})}},t.default=a.default.model("Article",d)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authJwt=t.authLocal=void 0;var n=u(o(4)),a=u(o(38)),i=o(37),s=u(o(0)),r=u(o(3));function u(e){return e&&e.__esModule?e:{default:e}}const l=new a.default({usernameField:"email"},async(e,t,o)=>{try{const n=await s.default.findOne({email:e});return n&&n.authenticateUser(t)?o(null,n):o(null,!1)}catch(e){return o(e,!1)}}),d={jwtFromRequest:i.ExtractJwt.fromAuthHeaderWithScheme("jwt"),secretOrKey:r.default.JWT_SECRET},c=new i.Strategy(d,async(e,t)=>{try{const o=await s.default.findById(e._id);return t(null,o?o:!1)}catch(e){return t(e,!1)}});n.default.use(l),n.default.use(c);t.authLocal=n.default.authenticate("local",{session:!1}),t.authJwt=n.default.authenticate("jwt",{session:!1})},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("faker")},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("chai")},function(e,t){e.exports=require("sinon")},function(e,t){e.exports=require("joi")},function(e,t){e.exports=require("express-validation")},function(e,t){e.exports=require("slug")},function(e,t){e.exports=require("mongoose-unique-validator")},function(e,t){e.exports=require("minio")},function(e,t){e.exports=require("express-session")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(2),a=s(n),i=(s(o(18)),o(1));function s(e){return e&&e.__esModule?e:{default:e}}const r=new n.Schema({title:{type:String,trim:!0,required:[!0,"Collection title is requires"],minlength:[3,"Title need to be longer"],maxlength:[24,"Title need to be shorter"],unique:!0},description:{type:String,trim:!0,required:!1,minlength:[5,"Description need to be longer"],maxlength:[48,"Description need to be shorter"]},photo:{type:String,trim:!0},user:{type:n.Schema.Types.ObjectId,ref:"User"},articles:[{type:n.Schema.Types.ObjectId,ref:"Article"}]},{timestamps:!0});r.methods={toJSON(){return{_id:this._id,title:this.title,description:this.description,photo:this.photo,user:this.user,articles:this.articles,createdAt:this.createdAt}},savePhoto(e){i.minioClient.putObject("mybucket",e.originalname,e.buffer,"application/octet-stream",function(e,t){if(e)return console.log(e);console.log("File uploaded successfully.")}),this.photo=e.originalname,this.save()},_articles:{add(e){this.articles.indexOf(e)>=0?(console.log("removing article from collection"),this.articles.remove(e)):(console.log("adding article to collection"),this.articles.push(e)),this.save()}}},r.statics={createCollection(e,t){return this.create(Object.assign({},e,{user:t}))}},t.default=a.default.model("Collection",r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCollection=async function(e,t){try{const o=await a.default.createCollection(e.body,e.user._id);return e.file&&await o.savePhoto(e.file),t.status(n.default.CREATED).json(o)}catch(e){t.status(n.default.BAD_REQUEST).json(e)}},t.updateCollection=async function(e,t){try{const o=await a.default.findById(e.params.id);return o.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{o[t]=e.body[t]}),e.file&&await o.savePhoto(e.file),t.status(n.default.OK).json(await o.save())):t.sendStatus(n.default.UNAUTHORIZED)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.getCollectionById=async function(e,t,o){try{const u=await a.default.findById(e.params.id).populate("articles").populate("user");if(!u.photo)return t.status(n.default.OK).json(u),o();var s=0,r="";i.minioClient.getObject("mybucket",u.photo,(e,a)=>{if(e)return console.log(e);a.on("data",e=>{s+=e.length,r+=e}),a.on("end",()=>(console.log("End. Total size = "+s),u.photo=r,t.status(n.default.OK).json(u),o()))})}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.addArticleToCollection=async function(e,t){try{const o=await a.default.findById(e.params.cid);return console.log(o),await o._articles.add(e.params.aid),t.sendStatus(n.default.OK)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.deleteCollection=async function(e,t){try{const o=await a.default.findById(e.params.id);return o.user.equals(e.user._id)?(await o.remove(),t.sendStatus(n.default.OK)):t.sendStatus(n.default.UNAUTHORIZED)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.getUserCollections=async function(e,t){try{const o=await a.default.find({user:e.params.uid}).populate("articles");return t.status(n.default.OK).json(o)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}};var n=s(o(8)),a=s(o(22)),i=(s(o(0)),o(1));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(o(16));t.default={createCollection:{body:{title:n.default.string().min(3).max(24).required(),description:n.default.string().min(10).max(48)}},updateCollection:{body:{title:n.default.string().min(5).max(24),description:n.default.string().min(10).max(48)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),a=l(o(17)),i=l(o(11)),s=l(o(24)),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(o(23)),u=o(10);function l(e){return e&&e.__esModule?e:{default:e}}const d=new n.Router;d.post("/",u.authJwt,(0,i.default)({storage:i.default.memoryStorage()}).single("photo"),(0,a.default)(s.default.createCollection),r.createCollection),d.patch("/:id",u.authJwt,(0,i.default)({storage:i.default.memoryStorage()}).single("photo"),(0,a.default)(s.default.updateCollection),r.updateCollection),d.get("/:id",u.authJwt,r.getCollectionById),d.post("/:cid/:aid",u.authJwt,r.addArticleToCollection),d.delete("/:id",u.authJwt,r.deleteCollection),d.get("/user/:uid",u.authJwt,r.getUserCollections),t.default=d},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createArticle=async function(e,t){console.log("inside the controller");try{const o=await s.default.createArticle(e.body,e.user._id);return await s.default.summarizeText(o,e.body.title,e.body.text),e.file&&await o.savePhoto(e.file),t.status(n.default.CREATED).json(o)}catch(e){t.status(n.default.BAD_REQUEST).json(e)}},t.getArticleById=async function(e,t){try{const u=await Promise.all([i.default.findById(e.user._id),s.default.findById(e.params.id).populate("user")]),l=u[0]._favourites.isArticleIsFavourite(e.params.id),d=u[1];if(e.file){var o=0,r="";a.minioClient.getObject("mybucket",d.photo,(e,a)=>{if(e)return console.log(e);a.on("data",e=>{o+=e.length,r+=e}),a.on("end",()=>(console.log("End. Total size = "+o),d.photo=r,t.status(n.default.OK).json(Object.assign({},d.toJSON(),{favourite:l}))))})}return t.status(n.default.OK).json(Object.assign({},d.toJSON(),{favourite:l}))}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.getArticlesList=async function(e,t){try{const o=await Promise.all([i.default.findById(e.user._id),s.default.list({limit:parseInt(e.query.limit,0),skip:parseInt(e.query.skip,0)})]),a=o[1].reduce((e,t)=>{const n=o[0]._favourites.isArticleIsFavourite(t._id);return e.push(Object.assign({},t.toJSON(),{favourite:n})),e},[]);return t.status(n.default.OK).json({data:a})}catch(e){t.status(n.default.BAD_REQUEST).json(e)}},t.updateArticle=async function(e,t){try{const o=await s.default.findById(e.params.id);return o.user.equals(e.user._id)?(Object.keys(e.body).forEach(t=>{o[t]=e.body[t]}),e.file?(await o.savePhoto(e.file),t.status(n.default.OK).json(o)):t.status(n.default.OK).json(await o.save())):t.sendStatus(n.default.UNAUTHORIZED)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.deleteArticle=async function(e,t){try{const o=await s.default.findById(e.params.id);return o.user.equals(e.user._id)?(await o.remove(),t.sendStatus(n.default.OK)):t.sendStatus(n.default.UNAUTHORIZED)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.favouriteArticle=async function(e,t){try{const o=await i.default.findById(e.user._id);return await o._favourites.articles(e.params.id),t.sendStatus(n.default.OK)}catch(e){t.status(n.default.BAD_REQUEST).json(e)}},t.toReadArticle=async function(e,t){try{const o=await i.default.findById(e.user._id);return await o._toRead.articles(e.params.id),t.sendStatus(n.default.OK)}catch(e){t.status(n.default.BAD_REQUEST).json(e)}};var n=r(o(8)),a=o(1),i=r(o(0)),s=r(o(9));function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(o(16));t.default={createArticle:{body:{title:n.default.string().min(3).max(24).required(),text:n.default.string().min(10).required()}},updateArticle:{body:{title:n.default.string().min(3).max(24),text:n.default.string().min(10)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),a=l(o(17)),i=l(o(11)),s=l(o(27)),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(o(26)),u=o(10);function l(e){return e&&e.__esModule?e:{default:e}}const d=new n.Router;d.post("/",u.authJwt,(0,i.default)({storage:i.default.memoryStorage()}).single("photo"),(0,a.default)(s.default.createArticle),r.createArticle),d.get("/:id",u.authJwt,r.getArticleById),d.get("/",u.authJwt,r.getArticlesList),d.patch("/:id",u.authJwt,(0,i.default)({storage:i.default.memoryStorage()}).single("photo"),(0,a.default)(s.default.updateArticle),r.updateArticle),d.delete("/:id",u.authJwt,r.deleteArticle),d.post("/:id/favourite",u.authJwt,r.favouriteArticle),d.post("/:id/toread",u.authJwt,r.toReadArticle),t.default=d},function(e,t){e.exports=require("fs")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.signup=async function(e,t){try{const o=await a.default.create(e.body);return t.status(n.default.CREATED).json(o.toAuthJSON())}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.twitterSignup=async function(e,t){try{!function(e,t){a.default.findOne({"twitter.id":e.id},(o,i)=>{if(i)return t.status(n.default.OK).json(i.toAuthJSON());{const o={id:e.id,fullName:e.displayName,screenName:e.username};var s=new a.default({userName:o.screenName,photo:e.photos[0].value,twitter:o});s.save((e,o)=>e?t.status(n.default.BAD_REQUEST):t.status(n.default.OK).json(o.toAuthJSON()))}})}(e.user,t)}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.login=function(e,t,o){try{const a=e.user;i.default.find({_id:{$in:a.favourites.articles}},(e,r)=>{a.favourites.articles=r,i.default.find({_id:{$in:a.toRead.articles}},(e,i)=>{if(a.toRead.articles=i,!a.photo)return t.status(n.default.OK).json(a.toAuthJSON()),o();var r=0,u="";s.minioClient.getObject("mybucket",a.photo,(e,i)=>{if(e)return console.log(e);i.on("data",e=>{r+=e.length,u+=e}),i.on("end",()=>(console.log("End. Total size = "+r),a.photo=u,t.status(n.default.OK).json(a),o()))})})})}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.follow=async function(e,t){try{const o=await a.default.findById(e.user._id);return e.user._id.equals(e.params.id)?t.sendStatus(n.default.BAD_REQUEST):(await o._followings.add(e.params.id),await a.default.checkFollower(e.params.id,e.user.id),t.sendStatus(n.default.OK))}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.update=async function(e,t){try{const o=await a.default.findById(e.user._id);return Object.keys(e.body).forEach(t=>{o[t]=e.body[t]}),e.file?(await o.savePhoto(e.file),t.status(n.default.OK).json(o)):t.status(n.default.OK).json(await o.save())}catch(e){return t.status(n.default.BAD_REQUEST).json(e)}},t.findUserById=async function(e,t){try{const o=await a.default.findById(e.params.id);return o?t.status(n.default.OK).json(o.toJSON()):t.status(n.default.BAD_REQUEST).json({message:"User not found!"})}catch(e){return t.status(n.default.BAD_REQUEST).josn(e)}};var n=r(o(8)),a=(r(o(29)),r(o(0))),i=r(o(9)),s=o(1);function r(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require("passport-twitter")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.authTwitterCallback=t.authTwitter=void 0;var n=i(o(4)),a=o(31);i(o(0)),i(o(3));function i(e){return e&&e.__esModule?e:{default:e}}const s=new a.Strategy({consumerKey:"EGLoBrQWNNtCDLYQKh6pupRO1",consumerSecret:"9FNzG4LlhCOhnNOf9VGS2SHQXAILjiLXTWfOrr9MT7W6nV05ww",callbackURL:"http://127.0.0.1:3000/api/v1/users/auth/twitter/callback"},async(e,t,o,n)=>{try{return n(null,o)}catch(e){return n(e,!1)}});n.default.use(s);t.authTwitter=n.default.authenticate("twitter",{session:!1}),t.authTwitterCallback=n.default.authenticate("twitter",{session:!1,failureRedirect:"/"})},function(e,t){e.exports=require("python-shell")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("validator")},function(e,t){e.exports=require("passport-jwt")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-facebook")},function(e,t){e.exports=require("path")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(5),a=(u(o(40)),u(o(11))),i=(u(o(20)),u(o(4)),u(o(39)),o(10)),s=o(32),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(o(30));o(1);function u(e){return e&&e.__esModule?e:{default:e}}const l=new n.Router;l.get("/:id",r.findUserById),l.post("/signup",r.signup),l.post("/login",i.authLocal,r.login),l.post("/:id/follow",i.authJwt,r.follow),l.patch("/update",i.authJwt,(0,a.default)({storage:a.default.memoryStorage()}).single("photo"),r.update),l.get("/login/twitter",s.authTwitter),l.get("/auth/twitter/callback",s.authTwitterCallback,r.twitterSignup),t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(o(41)),a=s(o(28)),i=s(o(25));function s(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use("/api/v1/users",n.default),e.use("/api/v1/articles",a.default),e.use("/api/v1/collections",i.default)})},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("morgan")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(o(46)),a=u(o(45)),i=u(o(44)),s=u(o(43)),r=u(o(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{e.use((0,i.default)()),e.use((0,s.default)()),e.use(a.default.json()),e.use(a.default.urlencoded({extended:!0})),e.use(r.default.initialize()),e.use((0,n.default)("combined"))})},function(e,t,o){"use strict";var n=i(o(2)),a=i(o(3));function i(e){return e&&e.__esModule?e:{default:e}}n.default.Promise=global.Promise;try{n.default.connect(a.default.MONGO_URL)}catch(e){n.default.createConnection(a.default.MONGO_URL)}n.default.connection.once("open",()=>console.log("MongodDB Running")).on("error",e=>{throw e})},function(e,t){e.exports=require("mongodb")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testArticleRoutes=function(){describe.only("Testing Article routes",function(){let e,t;var n,a=o(49).ObjectID;new a;s.seed(30);const l={irstName:s.name.firstName(),lastName:s.name.lastName(),email:s.internet.email(),password:s.internet.password(),userName:s.internet.userName()},d={title:s.lorem.words(),text:s.lorem.paragraphs()};before("should create new user",t=>{r.post("/signup").send(l).expect(201).end(function(o,a){n=a.body.token,e=a.body,i(201),t()})}),it("should create new article",e=>{u.post("/").set({authorization:n}).send(d).expect(201).end((o,n)=>{t=n.body,i(o).to.be.null,i(201),e()})}),it("should get an article by its id",e=>{u.get(`/${t._id}`).set({authorization:n}).expect(200).end((t,o)=>{i(t).to.be.null,i(200),e()})}),it("should modify the article",e=>{u.patch(`/${t._id}`).set({authorization:n}).send({title:"this is a new title"}).expect(200).end((t,o)=>{i(t).to.be.null,i(o.body).to.be.an("object"),e()})}),it("should add a pic to the article",e=>{u.patch(`/${t._id}`).set({authorization:n}).attach("photo","/home/dania/Octave/cartoon.jpeg").expect(200).end((t,o)=>{i(t).to.be.null,i(o.body).to.be.an("object"),e()})}),it("should favourite an article",e=>{u.post(`/${t._id}/favourite`).set({authorization:n}).expect(200).end((t,o)=>{i(t).to.be.null,i(o.body).to.be.an("object"),e()})}),it("should favourite an article",e=>{u.post(`/${t._id}/toread`).set({authorization:n}).expect(200).end((t,o)=>{i(t).to.be.null,i(o.body).to.be.an("object"),e()})}),it("should delete an article",e=>{u.delete(`/${t._id}`).set({authorization:n}).expect(200).end((t,o)=>{i(t).to.be.null,i(o.body).to.be.an("object"),e()})})})};n(o(0)),n(o(9));function n(e){return e&&e.__esModule?e:{default:e}}o(15);let a=o(14),i=(o(2),o(13),a.expect),s=o(12),r=o(7)("http://localhost:3000/api/v1/users"),u=o(7)("http://localhost:3000/api/v1/articles");o(6)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testArticleModel=function(){describe("Testing Article Model",function(){var e,t=o(49).ObjectID,a=new t;r.seed(801);const u={title:r.lorem.words(),slug:r.lorem.slug(),text:r.lorem.paragraphs(),summary:r.lorem.paragraph(),user:a};before("should create a new article",t=>{e=new n.default(u),console.log(e),e.save().then(()=>{i(!e.isNew),t()})}),it("Modifies the title of the created article",function(t){r.seed(200),n.default.findOneAndUpdate({_id:e._id},{title:r.lorem.words()},(e,o)=>{s(o).to.not.be.undefined,s(o._id).to.not.be.undefined,s(o.text).to.not.be.undefined,s(o.title).to.not.be.undefined,s(o.slug).to.not.be.undefined,s(o.summary).to.not.be.undefined,s(e).to.be.null,t()})}),it("Modifies the text of the created article",function(t){r.seed(300),n.default.findOneAndUpdate({_id:e._id},{text:r.lorem.paragraphs()},(e,o)=>{s(o).to.not.be.undefined,s(o).to.not.be.undefined,s(o._id).to.not.be.undefined,s(o.text).to.not.be.undefined,s(o.title).to.not.be.undefined,s(o.slug).to.not.be.undefined,s(o.summary).to.not.be.undefined,s(e).to.be.null,t()})}),it("Finds the created article",function(t){n.default.findOne({_id:e._id},(e,o)=>{s(o).to.not.be.undefined,s(o).to.not.be.undefined,s(o._id).to.not.be.undefined,s(o.text).to.not.be.undefined,s(o.title).to.not.be.undefined,s(o.slug).to.not.be.undefined,s(o.summary).to.not.be.undefined,s(e).to.be.null,t()})}),it("Deletes the created article",function(t){n.default.findOneAndRemove({_id:e._id},(e,o)=>{s(o).to.not.be.undefined,s(o).to.be.an("object"),s(e).to.be.null,t()})})})};var n=function(e){return e&&e.__esModule?e:{default:e}}(o(9));o(15);let a=o(14),i=(o(2),o(13)),s=a.expect,r=o(12);o(7)("http://localhost:3000/api/v1/users");o(6)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockDB=function(){describe("User Mocks",function(){r.seed(99);const e={firstName:r.name.firstName(),lastName:r.name.lastName(),email:r.internet.email(),password:r.internet.password(),userName:r.internet.userName()};it("Should create a new user",function(t){const o=new n.default(e),i=a.mock(o),r=i.object;i.expects("save").yields(null),r.save(e=>{i.verify(),i.restore(),s(e).to.be.null,t()})}),it("Should return error if user isn't created",function(t){const o=new n.default(e),i=a.mock(o),r=i.object;i.expects("save").yields({name:"ValidationError"}),r.save((e,o)=>{i.verify(),i.restore(),s(e.name).to.equal("ValidationError"),s(o).to.be.undefined,t()})}),it("Should find user by email",function(t){const o=a.mock(n.default),i=e;o.expects("findOne").withArgs({email:e.email}).yields(null,i),n.default.findOne({email:e.email},(n,a)=>{o.verify(),o.restore(),s(a.email).to.equal(e.email),t()})}),it("Should remove a user",function(t){const o=a.mock(n.default);o.expects("remove").withArgs({email:e.email}).yields(null,{nRemoved:1}),n.default.remove({email:e.email},(e,n)=>{o.verify(),o.restore(),s(e).to.be.null,s(n.nRemoved).to.equal(1),t()})})})};var n=function(e){return e&&e.__esModule?e:{default:e}}(o(0));let a=o(15),i=o(14),s=(o(2),o(13),i.expect),r=o(12);o(7)("http://localhost:3000/api/v1/users");o(6)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testRoutes=function(){describe("Testing User routes",function(){let e,t;i.seed(99);const o={irstName:i.name.firstName(),lastName:i.name.lastName(),email:i.internet.email(),password:i.internet.password(),userName:i.internet.userName()};i.seed(100);const n={irstName:i.name.firstName(),lastName:i.name.lastName(),email:i.internet.email(),password:i.internet.password(),userName:i.internet.userName()};it("should create new user",t=>{s.post("/signup").send(o).end(function(o,n){e=n.body.token,a(n.body._id).to.not.be.undefined,a(n.body.userName).to.not.be.undefined,a(n.body.token).to.not.be.undefined,a(n.body._id).to.be.a("string"),a(n.body.userName).to.be.a("string"),a(n.body.token).to.be.a("string"),a(n.statusCode).to.be.eq(201),a(o).to.be.null,a(201),t()})}),it("should login",t=>{s.post("/login").send({email:o.email,password:o.password}).query(e).expect(200).end((e,o)=>{a(o.body._id).to.not.be.undefined,a(o.body.userName).to.not.be.undefined,a(o.body.token).to.not.be.undefined,a(o.body._id).to.be.a("string"),a(o.body.userName).to.be.a("string"),a(o.body.token).to.be.a("string"),a(o.statusCode).to.be.eq(200),a(e).to.be.null,a(200),t()})}),it("should create new user2",e=>{s.post("/signup").send(n).end(function(o,n){t=n.body._id,a(201),a(n.body._id).to.not.be.undefined,a(n.body.userName).to.not.be.undefined,a(n.body.token).to.not.be.undefined,a(n.body._id).to.be.a("string"),a(n.body.userName).to.be.a("string"),a(n.body.token).to.be.a("string"),a(n.statusCode).to.be.eq(201),a(o).to.be.null,a(201),e()})}),it("user1 should follow user2",o=>{s.post(`/${t}/follow`).set({authorization:e}).expect(200).end((e,t)=>{a(e).to.be.null,a(t.body).to.be.an("object"),o()})}),it("should update user photo",t=>{s.patch("/update").set({authorization:e}).attach("photo","/home/dania/Octave/cartoon.jpeg").expect(200).end((e,o)=>{a(e).to.be.null,a(o.body).to.be.an("object"),t()})}),it("should change user's last name",t=>{s.patch("/update").set({authorization:e}).send({lastName:"XXX"}).expect(200).end((e,o)=>{a(e).to.be.null,a(o.body).to.be.an("object"),t()})}),it("should change user's password",t=>{s.patch("/update").set({authorization:e}).send({password:"newpass"}).expect(200).end((e,o)=>{a(e).to.be.null,a(o.body).to.be.an("object"),t()})}),it("try login with old password",t=>{s.post("/login").send({email:o.email,password:o.password}).query(e).expect(401).end((e,o)=>{a(e).to.be.null,a(o.body).to.be.an("object"),t()})}),it("should login with the new password",t=>{s.post("/login").send({email:o.email,password:"newpass"}).query(e).expect(200).end((e,o)=>{a(o.body._id).to.not.be.undefined,a(o.body.userName).to.not.be.undefined,a(o.body.token).to.not.be.undefined,a(o.body._id).to.be.a("string"),a(o.body.userName).to.be.a("string"),a(o.body.token).to.be.a("string"),a(o.statusCode).to.be.eq(200),a(e).to.be.null,a(200),t()})})})};!function(e){e&&e.__esModule}(o(0));o(15);let n=o(14),a=(o(2),o(13),n.expect),i=o(12),s=o(7)("http://localhost:3000/api/v1/users");o(6)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testModels=function(){describe("Testing User Model",function(){let e;r.seed(1e3);const t={firstName:r.name.firstName(),lastName:r.name.lastName(),email:r.internet.email(),password:r.internet.password(),userName:r.internet.userName()},o={firstName:r.name.firstName(),lastName:r.name.lastName(),email:r.internet.email(),password:r.internet.password()};before("Creates a new user to test it",function(o){(e=new n.default(t)).save().then(()=>{i(!e.isNew),o()})}),it("Modifies the created user",function(t){n.default.findOneAndUpdate({_id:e._id},{lastName:"Ref"},(e,o)=>{s(o).to.not.be.undefined,s(o).to.be.an("object"),s(o._id).to.not.be.undefined,s(o.userName).to.not.be.undefined,s(o.lastName).to.not.be.undefined,s(o.email).to.not.be.undefined,s(o.password).to.not.be.undefined,s(o.userName).to.not.be.undefined,s(o.email).to.match(/^.+@.+\..+$/),s(o.password).to.be.a("string"),s(o.firstName).to.be.a("string"),s(o.lastName).to.be.a("string"),s(o.userName).to.be.a("string"),s(o.email).to.be.a("string"),s(e).to.be.null,t()})}),it("Finds the created user",function(t){n.default.findOne({_id:e._id},(e,o)=>{s(o).to.not.be.undefined,s(o).to.be.an("object"),s(o._id).to.not.be.undefined,s(o.userName).to.not.be.undefined,s(o.lastName).to.not.be.undefined,s(o.email).to.not.be.undefined,s(o.password).to.not.be.undefined,s(o.userName).to.not.be.undefined,s(o.email).to.match(/^.+@.+\..+$/),s(o.password).to.be.a("string"),s(o.firstName).to.be.a("string"),s(o.lastName).to.be.a("string"),s(o.userName).to.be.a("string"),s(o.email).to.be.a("string"),s(e).to.be.null,t()})}),it("Deletes the created user",function(t){n.default.findOneAndRemove({_id:e._id},(e,o)=>{s(o).to.not.be.undefined,s(o).to.be.an("object"),s(e).to.be.null,t()})}),it("Missing userName",function(t){(e=new n.default(o)).save().then(()=>{i(e.isNew)}),t()}),it("Invalid email",function(o){(e=new n.default({firstName:t.firstName,lastName:t.lastName,email:"poldi1234@.com",password:t.password,userName:t.userName})).save().then(()=>{i(e.isNew)}),o()}),it("Weak password",function(o){(e=new n.default({firstName:t.firstName,lastName:t.lastName,email:t.email,password:"aaaaa123",userName:t.userName})).save().then(()=>{i(e.isNew)}),o()}),it("Short password",function(o){(e=new n.default({firstName:t.firstName,lastName:t.lastName,email:t.email,password:"aa23",userName:t.userName})).save().then(()=>{i(e.isNew)}),o()})})};var n=function(e){return e&&e.__esModule?e:{default:e}}(o(0));o(15);let a=o(14),i=(o(2),o(13)),s=a.expect,r=o(12);o(7)("http://localhost:3000/api/v1/users");o(6)},function(e,t,o){"use strict";!function(e){e&&e.__esModule}(o(0));o(15);let n=o(14),a=o(2);o(13),n.expect,o(12);o(7)("http://localhost:3000/api/v1/users");o(6);let i=o(54),s=o(53),r=o(52),u=o(51),l=o(50);before("Connecting to DB",function(e){a.connect("mongodb://localhost:27017/supreme-posts-test"),a.connection.once("open",()=>{console.log("connected to mongoDB"),a.connection.collections.users.drop(),e()}).on("error",e=>{throw e})}),s.testRoutes(),i.testModels(),r.mockDB(),u.testArticleModel(),l.testArticleRoutes()}]);